<!DOCTYPE html>
<html>
<head>
    <title>Customer Support Chatbot</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
<div class="chat-container">
    <h2>üõç Customer Support Chatbot</h2>

    <div id="chat-box" class="chat-box"></div>

    <div class="input-area">
        <input type="text" id="user-input" placeholder="Type your message..." autocomplete="off">
        <button onclick="sendMessage()">Send</button>
    </div>
</div>

<script>
    function renderButtons(buttons) {
        if (!buttons || buttons.length === 0) return "";

        let html = `<div class="quick-buttons">`;
        buttons.forEach(btn => {
            html += `<button class="quick-btn" data-value="${btn.value}">${btn.label}</button>`;
        });
        html += `</div>`;
        return html;
    }

    function sendMessage() {
        let userInput = document.getElementById("user-input").value;
        if (userInput.trim() === "") return;

        let chatBox = document.getElementById("chat-box");

        let userBubble = `<div class="chat-bubble user"><p>${userInput}</p></div>`;
        chatBox.innerHTML += userBubble;

        document.getElementById("user-input").value = "";

        let typingBubble = document.createElement("div");
        typingBubble.className = "chat-bubble bot typing";
        typingBubble.innerHTML = `<p><span class="dot"></span><span class="dot"></span><span class="dot"></span></p>`;
        chatBox.appendChild(typingBubble);
        chatBox.scrollTop = chatBox.scrollHeight;

        //sending message to Flask backend
        fetch("/get", {
            method: "POST",
            headers: {"Content-Type": "application/x-www-form-urlencoded"},
            body: "message=" + encodeURIComponent(userInput)
        })
            .then(res => res.json())
            .then(data => {

                setTimeout(() => {
                    typingBubble.remove();
                    let botBubble = `
                        <div class="chat-bubble bot">
                        <p>${data.response}</p>
                        ${renderButtons(data.buttons)}
                        </div>
                    `;
                    chatBox.innerHTML += botBubble;
                    chatBox.scrollTop = chatBox.scrollHeight;

                }, 1000);
            });
    }

    //allow pressing Enter to send message
    document.addEventListener("keypress", function(e) {
        if (e.key === "Enter") {
            const input = document.getElementById("user-input");
            if (input.value.trim() !== "") {
                sendMessage();
            }
        }
    });


    window.onload = function() {
        let chatBox = document.getElementById("chat-box");
        setTimeout(() => {
            let greeting = `<div class="chat-bubble bot"><p>Hi üëã I'm your Customer Support Chatbot. How can I help you today?</p></div>`;
            chatBox.innerHTML += greeting;
        }, 1000);
    };



    document.addEventListener("click", function(e) {
        if (e.target.classList.contains("quick-btn")) {
            const value = e.target.getAttribute("data-value");
            document.getElementById("user-input").value = value;
            sendMessage();
        }
    });


</script>

</body>
</html>
